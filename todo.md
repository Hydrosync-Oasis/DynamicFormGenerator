# 实现`useSyncExternalStore` + 生成不可变快照

==已完成==

表单生成器的内部结构在`FormModel`的一个字段`CompiledData`里，这个状态对象是要导出一个快照的**不可变对象**，需要做以下修改：

1. 规则没有从这个树中抽出来，需要单独抽出来，让这个状态更干净（因为规则不应该发生变化，是定的；规则只应该绑定给静态字段节点，也就是数组型字段的后代字段不能绑定规则）；
2. 校验对象也需要从树中抽出，因为和UI无关。和UI有关的是`errorMessage`。
3. 不应该有`rootArrayField`
4. `cache`删掉



# 实现原地设置数组值

==已完成==

**意义：**
保留`visible`，同时也能增强效率，未来可实现在数据没有变化时不触发渲染。

**分析：**

1. 对象型嵌套字段是全部静态的，仅和`schema`有关。
   - 这里可以直接在原地递归，直接设置
2. 数组型嵌套字段是动态的，和**值**有关。
   - 需要找到同key的子字段，递归进行设置



# 实现多套校验规则

**意义：**
处理不同时机下的自定义校验，`onChange`，`onBlur`，`onSubmit`，以及一些自定义校验时机下的规则，这些不同时机执行的规则可能都**不同**。

**分析：**
提交时应应用所有校验规则



# 自定义UI组件需要接收一个`ctx`的prop

**意义：**
实现在UI上通过用户自定义按钮触发回调函数以控制表单状态，如“点击按钮新增一项”。

# 实现事务

**意义：**
统一管理`notify()`调用。